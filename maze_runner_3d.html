<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Maze Runner - Game of the Day</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            font-family: 'Arial', sans-serif;
            overflow: hidden;
            color: white;
        }

        #gameContainer {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #gameCanvas {
            border: 2px solid #00ffff;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
            background: #000;
        }

        #ui {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 100;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #00ffff;
        }

        #gameInfo {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 100;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #00ffff;
            text-align: right;
        }

        #controls {
            position: absolute;
            bottom: 20px;
            left: 20px;
            z-index: 100;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #00ffff;
        }

        #backButton {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            background: #ff4444;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            text-decoration: none;
            display: inline-block;
        }

        #backButton:hover {
            background: #ff6666;
        }

        .game-title {
            color: #00ffff;
            text-shadow: 0 0 10px #00ffff;
            margin: 0 0 10px 0;
            font-size: 18px;
        }

        .game-date {
            color: #ffff00;
            font-size: 14px;
            margin: 5px 0;
        }

        #gameOverScreen {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 30px;
            border-radius: 15px;
            border: 2px solid #00ffff;
            text-align: center;
            z-index: 200;
            display: none;
        }

        #winScreen {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 100, 0, 0.9);
            padding: 30px;
            border-radius: 15px;
            border: 2px solid #00ff00;
            text-align: center;
            z-index: 200;
            display: none;
        }

        .restart-btn {
            background: #00ffff;
            color: #000;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
        }

        .restart-btn:hover {
            background: #00cccc;
        }

        @media (max-width: 768px) {
            #gameCanvas {
                width: 95vw;
                height: 60vh;
            }
            
            #ui, #gameInfo, #controls {
                font-size: 12px;
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <a href="index.html" id="backButton">‚Üê Back to Home</a>
        
        <div id="ui">
            <h2 class="game-title">3D Maze Runner</h2>
            <div class="game-date">Created: August 3, 2025</div>
            <div>Level: <span id="level">1</span></div>
            <div>Time: <span id="timer">0</span>s</div>
        </div>

        <div id="gameInfo">
            <div>Find the exit!</div>
            <div>Collect gems for bonus points</div>
            <div>Gems: <span id="gems">0</span></div>
        </div>

        <div id="controls">
            <div><strong>Controls:</strong></div>
            <div>WASD or Arrow Keys: Move</div>
            <div>Mouse: Look around</div>
            <div>Click to lock cursor</div>
        </div>

        <canvas id="gameCanvas" width="800" height="600"></canvas>

        <div id="gameOverScreen">
            <h2>Game Over!</h2>
            <p>You got lost in the maze!</p>
            <button class="restart-btn" onclick="restartGame()">Try Again</button>
        </div>

        <div id="winScreen">
            <h2>Congratulations!</h2>
            <p>You escaped the maze!</p>
            <p>Time: <span id="finalTime"></span>s</p>
            <p>Gems collected: <span id="finalGems"></span></p>
            <button class="restart-btn" onclick="nextLevel()">Next Level</button>
            <button class="restart-btn" onclick="restartGame()">Restart</button>
        </div>
    </div>

    <script>
        // Game variables
        let canvas, ctx;
        let gameState = 'playing'; // 'playing', 'won', 'lost'
        let level = 1;
        let startTime;
        let gems = 0;
        let playerX = 1.5, playerY = 1.5;
        let playerAngle = 0;
        let mouseX = 0, mouseY = 0;
        let keys = {};
        let pointerLocked = false;

        // Maze data - 1 = wall, 0 = empty, 2 = gem, 3 = exit
        let mazes = [
            // Level 1 - Simple maze
            [
                [1,1,1,1,1,1,1,1,1,1],
                [1,0,0,0,1,0,0,0,0,1],
                [1,0,1,0,1,0,1,1,0,1],
                [1,0,1,0,0,0,0,1,0,1],
                [1,0,1,1,1,1,0,1,0,1],
                [1,0,0,0,0,0,0,1,0,1],
                [1,1,1,0,1,1,1,1,0,1],
                [1,2,0,0,0,0,0,0,0,1],
                [1,0,1,1,1,1,1,1,3,1],
                [1,1,1,1,1,1,1,1,1,1]
            ],
            // Level 2 - More complex
            [
                [1,1,1,1,1,1,1,1,1,1,1,1],
                [1,0,0,0,0,1,0,0,0,0,2,1],
                [1,0,1,1,0,1,0,1,1,1,0,1],
                [1,0,0,1,0,0,0,1,0,0,0,1],
                [1,1,0,1,1,1,1,1,0,1,0,1],
                [1,0,0,0,0,0,0,0,0,1,0,1],
                [1,0,1,1,0,1,1,1,0,1,0,1],
                [1,0,0,1,0,0,0,1,0,0,0,1],
                [1,1,0,1,1,1,0,1,1,1,1,1],
                [1,2,0,0,0,0,0,0,0,0,0,1],
                [1,0,1,1,1,1,1,1,1,1,3,1],
                [1,1,1,1,1,1,1,1,1,1,1,1]
            ]
        ];

        let currentMaze;

        // Initialize game
        function init() {
            canvas = document.getElementById('gameCanvas');
            ctx = canvas.getContext('2d');
            
            // Set up event listeners
            document.addEventListener('keydown', handleKeyDown);
            document.addEventListener('keyup', handleKeyUp);
            canvas.addEventListener('click', lockPointer);
            document.addEventListener('pointerlockchange', pointerLockChange);
            document.addEventListener('mousemove', handleMouseMove);

            // Initialize game state
            resetGame();
            
            // Start game loop
            gameLoop();
        }

        function resetGame() {
            currentMaze = mazes[level - 1] || mazes[0];
            playerX = 1.5;
            playerY = 1.5;
            playerAngle = 0;
            gems = 0;
            startTime = Date.now();
            gameState = 'playing';
            
            document.getElementById('level').textContent = level;
            document.getElementById('gems').textContent = gems;
            document.getElementById('gameOverScreen').style.display = 'none';
            document.getElementById('winScreen').style.display = 'none';
        }

        function lockPointer() {
            canvas.requestPointerLock();
        }

        function pointerLockChange() {
            pointerLocked = document.pointerLockElement === canvas;
        }

        function handleMouseMove(e) {
            if (pointerLocked && gameState === 'playing') {
                playerAngle += e.movementX * 0.002;
            }
        }

        function handleKeyDown(e) {
            keys[e.code] = true;
        }

        function handleKeyUp(e) {
            keys[e.code] = false;
        }

        function updatePlayer() {
            if (gameState !== 'playing') return;

            const moveSpeed = 0.05;
            let newX = playerX;
            let newY = playerY;

            // Handle movement
            if (keys['KeyW'] || keys['ArrowUp']) {
                newX += Math.cos(playerAngle) * moveSpeed;
                newY += Math.sin(playerAngle) * moveSpeed;
            }
            if (keys['KeyS'] || keys['ArrowDown']) {
                newX -= Math.cos(playerAngle) * moveSpeed;
                newY -= Math.sin(playerAngle) * moveSpeed;
            }
            if (keys['KeyA'] || keys['ArrowLeft']) {
                newX += Math.cos(playerAngle - Math.PI/2) * moveSpeed;
                newY += Math.sin(playerAngle - Math.PI/2) * moveSpeed;
            }
            if (keys['KeyD'] || keys['ArrowRight']) {
                newX += Math.cos(playerAngle + Math.PI/2) * moveSpeed;
                newY += Math.sin(playerAngle + Math.PI/2) * moveSpeed;
            }

            // Collision detection
            const mapX = Math.floor(newX);
            const mapY = Math.floor(newY);
            
            if (currentMaze[mapY] && currentMaze[mapY][mapX] !== 1) {
                playerX = newX;
                playerY = newY;

                // Check for gems
                if (currentMaze[mapY][mapX] === 2) {
                    currentMaze[mapY][mapX] = 0; // Remove gem
                    gems++;
                    document.getElementById('gems').textContent = gems;
                }

                // Check for exit
                if (currentMaze[mapY][mapX] === 3) {
                    winGame();
                }
            }
        }

        function castRay(angle) {
            const rayX = Math.cos(angle);
            const rayY = Math.sin(angle);
            
            let distance = 0;
            let hit = false;
            let hitType = 0; // 0 = nothing, 1 = wall, 2 = gem, 3 = exit
            let gemDistance = null;
            let exitDistance = null;
            
            while (!hit && distance < 20) {
                distance += 0.05; // Smaller steps for better detection
                const testX = Math.floor(playerX + rayX * distance);
                const testY = Math.floor(playerY + rayY * distance);
                
                if (currentMaze[testY] && currentMaze[testY][testX]) {
                    if (currentMaze[testY][testX] === 1) {
                        hit = true;
                        hitType = 1;
                    } else if (currentMaze[testY][testX] === 2 && !gemDistance) {
                        gemDistance = distance;
                    } else if (currentMaze[testY][testX] === 3 && !exitDistance) {
                        exitDistance = distance;
                    }
                }
            }
            
            return { distance, hitType, gemDistance, exitDistance };
        }

        function render() {
            // Clear canvas
            ctx.fillStyle = '#001122';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Draw ceiling
            ctx.fillStyle = '#003366';
            ctx.fillRect(0, 0, canvas.width, canvas.height / 2);

            // Draw floor
            ctx.fillStyle = '#112233';
            ctx.fillRect(0, canvas.height / 2, canvas.width, canvas.height / 2);

            // Raycasting
            const fov = Math.PI / 3; // 60 degrees
            const numRays = canvas.width;
            
            for (let i = 0; i < numRays; i++) {
                const rayAngle = playerAngle - fov/2 + (fov * i / numRays);
                const ray = castRay(rayAngle);
                
                // Calculate wall height
                const wallHeight = (canvas.height / 2) / (ray.distance * Math.cos(rayAngle - playerAngle));
                const wallTop = (canvas.height / 2) - wallHeight;
                const wallBottom = (canvas.height / 2) + wallHeight;
                
                // Color based on distance with better visibility
                const brightness = Math.max(0.3, 1 - ray.distance / 8);
                
                // Use different colors for better visibility instead of plain white
                let wallColor;
                if (ray.distance < 2) {
                    wallColor = `rgb(${Math.floor(120 * brightness)}, ${Math.floor(80 * brightness)}, ${Math.floor(200 * brightness)})`;
                } else if (ray.distance < 5) {
                    wallColor = `rgb(${Math.floor(100 * brightness)}, ${Math.floor(150 * brightness)}, ${Math.floor(180 * brightness)})`;
                } else {
                    wallColor = `rgb(${Math.floor(80 * brightness)}, ${Math.floor(120 * brightness)}, ${Math.floor(160 * brightness)})`;
                }
                
                // Draw wall slice
                ctx.fillStyle = wallColor;
                ctx.fillRect(i, wallTop, 1, wallHeight * 2);
                
                // Draw gems in 3D view
                if (ray.gemDistance && ray.gemDistance < ray.distance) {
                    const gemHeight = (canvas.height / 4) / (ray.gemDistance * Math.cos(rayAngle - playerAngle));
                    const gemTop = (canvas.height / 2) - gemHeight / 2;
                    ctx.fillStyle = '#FFD700';
                    ctx.fillRect(i, gemTop, 1, gemHeight);
                }
                
                // Draw exits in 3D view
                if (ray.exitDistance && ray.exitDistance < ray.distance) {
                    const exitHeight = (canvas.height / 3) / (ray.exitDistance * Math.cos(rayAngle - playerAngle));
                    const exitTop = (canvas.height / 2) - exitHeight / 2;
                    ctx.fillStyle = '#00FF00';
                    ctx.fillRect(i, exitTop, 1, exitHeight);
                }
                
                // Add some texture variation
                if (i % 4 === 0 && ray.hitType === 1) {
                    const dimColor = Math.floor(brightness * 60);
                    ctx.fillStyle = `rgb(${dimColor}, ${dimColor}, ${dimColor})`;
                    ctx.fillRect(i, wallTop, 1, wallHeight * 2);
                }
            }

            // Draw minimap
            drawMinimap();
        }

        function drawMinimap() {
            const mapSize = 120;
            const cellSize = mapSize / currentMaze.length;
            
            // Minimap background
            ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
            ctx.fillRect(canvas.width - mapSize - 10, 10, mapSize, mapSize);
            
            // Draw maze
            for (let y = 0; y < currentMaze.length; y++) {
                for (let x = 0; x < currentMaze[y].length; x++) {
                    const cellX = canvas.width - mapSize - 10 + x * cellSize;
                    const cellY = 10 + y * cellSize;
                    
                    if (currentMaze[y][x] === 1) {
                        ctx.fillStyle = '#ffffff';
                    } else if (currentMaze[y][x] === 2) {
                        ctx.fillStyle = '#ffff00';
                    } else if (currentMaze[y][x] === 3) {
                        ctx.fillStyle = '#00ff00';
                    } else {
                        ctx.fillStyle = '#333333';
                    }
                    
                    ctx.fillRect(cellX, cellY, cellSize, cellSize);
                }
            }
            
            // Draw player
            const playerMapX = canvas.width - mapSize - 10 + playerX * cellSize;
            const playerMapY = 10 + playerY * cellSize;
            
            ctx.fillStyle = '#ff0000';
            ctx.beginPath();
            ctx.arc(playerMapX, playerMapY, 3, 0, Math.PI * 2);
            ctx.fill();
            
            // Draw player direction
            ctx.strokeStyle = '#ff0000';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(playerMapX, playerMapY);
            ctx.lineTo(
                playerMapX + Math.cos(playerAngle) * 10,
                playerMapY + Math.sin(playerAngle) * 10
            );
            ctx.stroke();
        }

        function updateTimer() {
            if (gameState === 'playing') {
                const elapsed = Math.floor((Date.now() - startTime) / 1000);
                document.getElementById('timer').textContent = elapsed;
            }
        }

        function winGame() {
            gameState = 'won';
            const finalTime = Math.floor((Date.now() - startTime) / 1000);
            document.getElementById('finalTime').textContent = finalTime;
            document.getElementById('finalGems').textContent = gems;
            document.getElementById('winScreen').style.display = 'block';
        }

        function nextLevel() {
            level++;
            if (level > mazes.length) {
                level = 1; // Loop back to first level
            }
            document.getElementById('level').textContent = level;
            resetGame();
        }

        function restartGame() {
            level = 1;
            document.getElementById('level').textContent = level;
            resetGame();
        }

        function gameLoop() {
            updatePlayer();
            updateTimer();
            render();
            requestAnimationFrame(gameLoop);
        }

        // Start the game when page loads
        window.addEventListener('load', init);
    </script>
</body>
</html>

