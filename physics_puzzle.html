<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Physics Puzzle Platformer - Bot Built Arcade</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            font-family: 'Arial', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            color: white;
        }
        
        .header {
            text-align: center;
            padding: 20px;
            background: rgba(0, 0, 0, 0.7);
            width: 100%;
            box-shadow: 0 2px 10px rgba(0,0,0,0.5);
        }
        
        .header h1 {
            margin: 0;
            color: #fff80d;
            text-shadow: 2px 2px 6px #000;
            font-size: 2.5em;
        }
        
        .date {
            color: #00e5ff;
            font-size: 1.2em;
            margin: 10px 0;
            text-shadow: 1px 1px 3px #000;
        }
        
        .game-container {
            margin: 20px;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.6);
        }
        
        canvas {
            border: 3px solid #00e5ff;
            border-radius: 8px;
            background: #87CEEB;
            display: block;
            margin: 0 auto;
            box-shadow: 0 0 20px rgba(0, 229, 255, 0.5);
        }
        
        .controls {
            text-align: center;
            margin: 20px 0;
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
        }
        
        .controls h3 {
            margin-top: 0;
            color: #fff80d;
        }
        
        .controls p {
            margin: 5px 0;
            color: #ffffff;
        }
        
        .score {
            text-align: center;
            font-size: 1.5em;
            margin: 10px 0;
            color: #00e5ff;
            text-shadow: 1px 1px 3px #000;
        }
        
        .back-btn {
            display: inline-block;
            padding: 12px 24px;
            background-color: #ff6060;
            color: white;
            text-decoration: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: bold;
            margin: 20px;
            box-shadow: 0 4px 8px rgba(255, 96, 96, 0.3);
            transition: all 0.3s ease;
        }
        
        .back-btn:hover {
            background-color: #ff4040;
            box-shadow: 0 6px 12px rgba(255, 96, 96, 0.5);
            transform: translateY(-2px);
        }
        
        .reset-btn {
            display: inline-block;
            padding: 10px 20px;
            background-color: #6600ff;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px;
            box-shadow: 0 4px 8px rgba(102, 0, 255, 0.3);
            transition: all 0.3s ease;
        }
        
        .reset-btn:hover {
            background-color: #5500dd;
            box-shadow: 0 6px 12px rgba(102, 0, 255, 0.5);
            transform: translateY(-2px);
        }
        
        @media (max-width: 768px) {
            canvas {
                width: 90vw;
                height: auto;
            }
            
            .header h1 {
                font-size: 2em;
            }
        }
        #rate {
            margin-top: 10px;
            font-size: 24px;
        }
        #rate span.selected {
            color: orange;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üß© Physics Puzzle Platformer</h1>
        <div class="date">Created: January 29, 2025</div>
        <a href="index.html" class="back-btn">‚Üê Back to Home</a>
    </div>
    
    <div class="game-container">
        <div class="score">Level: <span id="level">1</span> | Gems: <span id="gems">0</span>/3</div>
        
        <canvas id="gameCanvas" width="800" height="600"></canvas>
        
        <div class="controls">
            <h3>üéÆ Controls</h3>
            <p><strong>Arrow Keys:</strong> Move left/right</p>
            <p><strong>Spacebar:</strong> Jump</p>
            <p><strong>R:</strong> Reset level</p>
            <p><strong>Goal:</strong> Collect all gems and reach the exit portal!</p>
        </div>
        
        <button class="reset-btn" onclick="resetLevel()">Reset Level</button>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        // Game state
        let currentLevel = 1;
        let gemsCollected = 0;
        let totalGems = 3;
        let gameWon = false;
        
        // Player object
        const player = {
            x: 50,
            y: 500,
            width: 30,
            height: 30,
            vx: 0,
            vy: 0,
            speed: 5,
            jumpPower: 15,
            onGround: false,
            color: '#ff6060'
        };
        
        // Physics constants
        const gravity = 0.8;
        const friction = 0.85;
        
        // Game objects
        let platforms = [];
        let gems = [];
        let movingPlatforms = [];
        let exit = null;
        
        // Character image
        let characterImage = new Image();
        let imageLoaded = false;
        characterImage.onload = function() {
            imageLoaded = true;
        };
        characterImage.src = 'images/puzzle_robot_character_transparent.png';
        
        // Input handling
        const keys = {};
        
        document.addEventListener('keydown', (e) => {
            keys[e.code] = true;
            if (e.code === 'KeyR') {
                resetLevel();
            }
        });
        
        document.addEventListener('keyup', (e) => {
            keys[e.code] = false;
        });
        
        // Initialize level
        function initLevel(level) {
            platforms = [];
            gems = [];
            movingPlatforms = [];
            gemsCollected = 0;
            gameWon = false;
            
            // Reset player position
            player.x = 50;
            player.y = 500;
            player.vx = 0;
            player.vy = 0;
            
            if (level === 1) {
                // Level 1: Basic platforming
                platforms = [
                    {x: 0, y: 580, width: 800, height: 20, color: '#8B4513'}, // Ground
                    {x: 200, y: 480, width: 100, height: 20, color: '#8B4513'},
                    {x: 400, y: 380, width: 100, height: 20, color: '#8B4513'},
                    {x: 600, y: 280, width: 100, height: 20, color: '#8B4513'},
                    {x: 350, y: 180, width: 200, height: 20, color: '#8B4513'}
                ];
                
                gems = [
                    {x: 230, y: 450, width: 20, height: 20, collected: false},
                    {x: 430, y: 350, width: 20, height: 20, collected: false},
                    {x: 430, y: 150, width: 20, height: 20, collected: false}
                ];
                
                exit = {x: 720, y: 240, width: 40, height: 40};
                
            } else if (level === 2) {
                // Level 2: Moving platforms
                platforms = [
                    {x: 0, y: 580, width: 200, height: 20, color: '#8B4513'}, // Ground
                    {x: 600, y: 580, width: 200, height: 20, color: '#8B4513'},
                    {x: 100, y: 400, width: 100, height: 20, color: '#8B4513'},
                    {x: 500, y: 300, width: 100, height: 20, color: '#8B4513'},
                    {x: 300, y: 150, width: 200, height: 20, color: '#8B4513'}
                ];
                
                movingPlatforms = [
                    {x: 250, y: 500, width: 100, height: 20, color: '#FF6347', 
                     vx: 2, minX: 200, maxX: 400},
                    {x: 350, y: 250, width: 100, height: 20, color: '#FF6347', 
                     vx: -1.5, minX: 300, maxX: 500}
                ];
                
                gems = [
                    {x: 130, y: 370, width: 20, height: 20, collected: false},
                    {x: 530, y: 270, width: 20, height: 20, collected: false},
                    {x: 380, y: 120, width: 20, height: 20, collected: false}
                ];
                
                exit = {x: 720, y: 540, width: 40, height: 40};
                
            } else if (level === 3) {
                // Level 3: Complex puzzle
                platforms = [
                    {x: 0, y: 580, width: 150, height: 20, color: '#8B4513'},
                    {x: 650, y: 580, width: 150, height: 20, color: '#8B4513'},
                    {x: 100, y: 450, width: 80, height: 20, color: '#8B4513'},
                    {x: 300, y: 350, width: 80, height: 20, color: '#8B4513'},
                    {x: 500, y: 450, width: 80, height: 20, color: '#8B4513'},
                    {x: 620, y: 350, width: 80, height: 20, color: '#8B4513'},
                    {x: 350, y: 150, width: 100, height: 20, color: '#8B4513'}
                ];
                
                movingPlatforms = [
                    {x: 200, y: 520, width: 80, height: 20, color: '#FF6347', 
                     vx: 1, minX: 150, maxX: 300},
                    {x: 400, y: 280, width: 80, height: 20, color: '#FF6347', 
                     vx: -2, minX: 380, maxX: 520},
                    {x: 250, y: 200, width: 80, height: 20, color: '#FF6347', 
                     vx: 1.5, minX: 200, maxX: 450}
                ];
                
                gems = [
                    {x: 130, y: 420, width: 20, height: 20, collected: false},
                    {x: 650, y: 320, width: 20, height: 20, collected: false},
                    {x: 380, y: 120, width: 20, height: 20, collected: false}
                ];
                
                exit = {x: 720, y: 540, width: 40, height: 40};
            }
            
            totalGems = gems.length;
            updateUI();
        }
        
        function updateUI() {
            document.getElementById('level').textContent = currentLevel;
            document.getElementById('gems').textContent = gemsCollected;
        }
        
        function resetLevel() {
            initLevel(currentLevel);
        }
        
        function update() {
            // Handle input
            if (keys['ArrowLeft']) {
                player.vx = -player.speed;
            } else if (keys['ArrowRight']) {
                player.vx = player.speed;
            } else {
                player.vx *= friction;
            }
            
            if (keys['Space'] && player.onGround) {
                player.vy = -player.jumpPower;
                player.onGround = false;
            }
            
            // Apply gravity
            player.vy += gravity;
            
            // Update player position
            player.x += player.vx;
            player.y += player.vy;
            
            // Update moving platforms
            movingPlatforms.forEach(platform => {
                platform.x += platform.vx;
                if (platform.x <= platform.minX || platform.x + platform.width >= platform.maxX) {
                    platform.vx = -platform.vx;
                }
            });
            
            // Collision detection with platforms
            player.onGround = false;
            
            [...platforms, ...movingPlatforms].forEach(platform => {
                if (player.x < platform.x + platform.width &&
                    player.x + player.width > platform.x &&
                    player.y < platform.y + platform.height &&
                    player.y + player.height > platform.y) {
                    
                    // Top collision (landing on platform)
                    if (player.vy > 0 && player.y < platform.y) {
                        player.y = platform.y - player.height;
                        player.vy = 0;
                        player.onGround = true;
                        
                        // Move with moving platform
                        if (platform.vx !== undefined) {
                            player.x += platform.vx;
                        }
                    }
                    // Bottom collision (hitting platform from below)
                    else if (player.vy < 0 && player.y > platform.y) {
                        player.y = platform.y + platform.height;
                        player.vy = 0;
                    }
                    // Side collisions
                    else if (player.vx > 0 && player.x < platform.x) {
                        player.x = platform.x - player.width;
                        player.vx = 0;
                    }
                    else if (player.vx < 0 && player.x > platform.x) {
                        player.x = platform.x + platform.width;
                        player.vx = 0;
                    }
                }
            });
            
            // Boundary collision
            if (player.x < 0) {
                player.x = 0;
                player.vx = 0;
            }
            if (player.x + player.width > canvas.width) {
                player.x = canvas.width - player.width;
                player.vx = 0;
            }
            
            // Fall off screen - reset level
            if (player.y > canvas.height) {
                resetLevel();
                return;
            }
            
            // Gem collection
            gems.forEach(gem => {
                if (!gem.collected &&
                    player.x < gem.x + gem.width &&
                    player.x + player.width > gem.x &&
                    player.y < gem.y + gem.height &&
                    player.y + player.height > gem.y) {
                    
                    gem.collected = true;
                    gemsCollected++;
                    updateUI();
                }
            });
            
            // Exit collision (only if all gems collected)
            if (gemsCollected === totalGems && exit &&
                player.x < exit.x + exit.width &&
                player.x + player.width > exit.x &&
                player.y < exit.y + exit.height &&
                player.y + player.height > exit.y) {
                
                if (currentLevel < 3) {
                    currentLevel++;
                    initLevel(currentLevel);
                } else {
                    gameWon = true;
                }
            }
        }
        
        function draw() {
            // Clear canvas
            ctx.fillStyle = '#87CEEB';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Draw platforms
            platforms.forEach(platform => {
                ctx.fillStyle = platform.color;
                ctx.fillRect(platform.x, platform.y, platform.width, platform.height);
                
                // Add some texture
                ctx.fillStyle = 'rgba(0, 0, 0, 0.2)';
                ctx.fillRect(platform.x, platform.y, platform.width, 5);
            });
            
            // Draw moving platforms
            movingPlatforms.forEach(platform => {
                ctx.fillStyle = platform.color;
                ctx.fillRect(platform.x, platform.y, platform.width, platform.height);
                
                // Add glow effect
                ctx.shadowColor = platform.color;
                ctx.shadowBlur = 10;
                ctx.fillRect(platform.x, platform.y, platform.width, platform.height);
                ctx.shadowBlur = 0;
            });
            
            // Draw gems
            gems.forEach(gem => {
                if (!gem.collected) {
                    ctx.fillStyle = '#FFD700';
                    ctx.fillRect(gem.x, gem.y, gem.width, gem.height);
                    
                    // Add sparkle effect
                    ctx.fillStyle = '#FFFF00';
                    ctx.fillRect(gem.x + 5, gem.y + 5, 10, 10);
                    
                    // Rotating diamond effect
                    const time = Date.now() * 0.005;
                    ctx.save();
                    ctx.translate(gem.x + gem.width/2, gem.y + gem.height/2);
                    ctx.rotate(time);
                    ctx.fillStyle = '#FFD700';
                    ctx.fillRect(-8, -8, 16, 16);
                    ctx.restore();
                }
            });
            
            // Draw exit portal (only if all gems collected)
            if (exit && gemsCollected === totalGems) {
                const time = Date.now() * 0.01;
                ctx.save();
                ctx.translate(exit.x + exit.width/2, exit.y + exit.height/2);
                
                // Swirling portal effect
                for (let i = 0; i < 8; i++) {
                    ctx.save();
                    ctx.rotate(time + i * Math.PI / 4);
                    ctx.fillStyle = `hsl(${(time * 50 + i * 45) % 360}, 70%, 60%)`;
                    ctx.fillRect(-15, -3, 30, 6);
                    ctx.restore();
                }
                
                ctx.restore();
                
                // Portal center
                ctx.fillStyle = '#000';
                ctx.fillRect(exit.x + 10, exit.y + 10, 20, 20);
            }
            
            // Draw player
            if (imageLoaded) {
                // Draw the character image scaled to fit the player size
                ctx.drawImage(characterImage, player.x, player.y, player.width, player.height);
            } else {
                // Fallback to original rectangle if image not loaded
                ctx.fillStyle = player.color;
                ctx.fillRect(player.x, player.y, player.width, player.height);
                
                // Add player eyes
                ctx.fillStyle = '#FFF';
                ctx.fillRect(player.x + 5, player.y + 8, 6, 6);
                ctx.fillRect(player.x + 19, player.y + 8, 6, 6);
                ctx.fillStyle = '#000';
                ctx.fillRect(player.x + 7, player.y + 10, 2, 2);
                ctx.fillRect(player.x + 21, player.y + 10, 2, 2);
            }
            
            // Draw UI text
            if (gemsCollected < totalGems) {
                ctx.fillStyle = '#FFF';
                ctx.font = '20px Arial';
                ctx.fillText('Collect all gems to unlock the exit!', 20, 40);
            }
            
            // Game won message
            if (gameWon) {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.8)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                ctx.fillStyle = '#FFD700';
                ctx.font = '48px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('üéâ CONGRATULATIONS! üéâ', canvas.width/2, canvas.height/2 - 50);
                
                ctx.fillStyle = '#FFF';
                ctx.font = '24px Arial';
                ctx.fillText('You completed all levels!', canvas.width/2, canvas.height/2);
                ctx.fillText('Press R to restart from level 1', canvas.width/2, canvas.height/2 + 40);
                
                ctx.textAlign = 'left';
            }
        }
        
        function gameLoop() {
            if (gameWon && keys['KeyR']) {
                currentLevel = 1;
                gameWon = false;
                initLevel(currentLevel);
            }
            
            if (!gameWon) {
                update();
            }
            draw();
            requestAnimationFrame(gameLoop);
        }
        
        // Initialize and start the game
        initLevel(1);
        gameLoop();
        
        // Prevent spacebar from scrolling the page
        window.addEventListener('keydown', function(e) {
            if(e.keyCode === 32 && e.target === document.body) {
                e.preventDefault();
            }
        });
</script>
<div id="rate">
  <span data-star="1">‚òÖ</span>
  <span data-star="2">‚òÖ</span>
  <span data-star="3">‚òÖ</span>
  <span data-star="4">‚òÖ</span>
  <span data-star="5">‚òÖ</span>
</div>
<p id="score"></p>
<script>
const gameId = "physics-puzzle";

document.querySelectorAll('#rate span').forEach(el =>
  el.onclick = async () => {
    await fetch('/api/rate', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ gameId, stars: parseInt(el.dataset.star) })
    });
    load();
  });

async function load() {
  const r = await fetch(`/api/ratings/${gameId}`).then(r => r.json());
  document.getElementById('score').textContent =
    `${r.average} ‚òÖ from ${r.votes} votes` + (r.mine ? ` - You rated ${r.mine}` : '');
  document.querySelectorAll('#rate span').forEach(span => {
    span.classList.toggle('selected', r.mine && +span.dataset.star <= r.mine);
  });
}
load();
</script>
</body>
</html>

