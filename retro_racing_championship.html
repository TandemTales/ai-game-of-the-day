<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Retro Racing Championship</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
            font-family: 'Courier New', monospace;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
        }

        #gameContainer {
            position: relative;
            border: 3px solid #00ffff;
            border-radius: 10px;
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.5);
            background: #000;
        }

        #gameCanvas {
            display: block;
            background: linear-gradient(180deg, #87ceeb 0%, #98fb98 50%, #228b22 100%);
        }

        #ui {
            position: absolute;
            top: 10px;
            left: 10px;
            color: #fff;
            font-size: 16px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
            z-index: 10;
        }

        .featured {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.4);
        }

        .featured h2 {
            margin-top: 0;
            color: #fff;
            font-size: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .featured .date-info {
            color: #81c784;
            font-size: 12px;
            margin-bottom: 15px;
            font-style: italic;
        }

        #gameOver {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            color: #00ffff;
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            border: 2px solid #00ffff;
            z-index: 20;
            display: none;
        }

        #startScreen {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            color: #00ffff;
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            border: 2px solid #00ffff;
            z-index: 20;
        }

        .button {
            background: linear-gradient(45deg, #00ffff, #0080ff);
            color: #000;
            border: none;
            padding: 12px 24px;
            margin: 10px;
            border-radius: 6px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 30;
        }

        .button:hover {
            background: linear-gradient(45deg, #00cccc, #0066cc);
            transform: scale(1.05);
        }

        .controls {
            margin-top: 20px;
            font-size: 14px;
            color: #aaaaaa;
        }

        #backButton {
            position: absolute;
            top: 10px;
            right: 10px;
            background: linear-gradient(45deg, #ff4444, #cc0000);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 30;
        }

        #backButton:hover {
            background: linear-gradient(45deg, #ff6666, #ee2222);
            transform: scale(1.05);
        }

        .rate {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin-top: 10px;
        }

        .rate span {
            cursor: pointer;
            color: gold;
        }

        .rate span.selected {
            color: orange;
        }

        .rate span:hover {
            background-color: #1affff;
            box-shadow: 0 0 12px #1affff;
        }

        .score {
            display: block;
            margin-top: 5px;
            color: #ffea00;
        }

        ul {
            list-style: none;
            padding: 0;
        }

        li {
            margin: 12px 0;
        }

        li a {
            font-size: 18px;
            color: #00ffff;
            text-decoration: underline;
        }

        li a:hover {
            color: #ffea00;
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <canvas id="gameCanvas" width="800" height="600"></canvas>
        
        <div id="ui">
            <div>Speed: <span id="speed">0</span> mph</div>
            <div>Lap: <span id="lap">1</span>/3</div>
            <div>Position: <span id="position">1</span>/8</div>
            <div>Time: <span id="time">0:00</span></div>
        </div>

        <div id="startScreen">
            <h1 style="color: #00ffff; margin-bottom: 20px;">üèÅ RETRO RACING CHAMPIONSHIP üèÅ</h1>
            <div class="date-info">Created: August 8, 2025</div>
            <p style="margin-bottom: 20px;">Race through retro circuits in this Super Nintendo-style racing game!</p>
            <button class="button" onclick="startGame()">START RACE</button>
            <div class="controls">
                <strong>Controls:</strong><br>
                ARROW KEYS - Steer & Accelerate/Brake<br>
                SPACEBAR - Turbo Boost<br>
                R - Restart Race
            </div>
        </div>

        <div id="gameOver">
            <h2>Race Complete!</h2>
            <p>Final Position: <span id="finalPosition">0</span>/8</p>
            <p>Best Lap Time: <span id="bestLap">0:00</span></p>
            <button class="button" onclick="restartGame()">Race Again</button>
            <button class="button" onclick="showStartScreen()">Main Menu</button>
        </div>

        <button id="backButton" onclick="goHome()">‚Üê Back to Home</button>
    </div>

    <script>
        // Game variables
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        let gameState = 'start'; // 'start', 'playing', 'gameOver'
        let speed = 0;
        let maxSpeed = 200;
        let acceleration = 0.5;
        let deceleration = 0.3;
        let turboBoost = false;
        let turboEnergy = 100;
        
        // Player car
        let player = {
            x: 400,
            y: 500,
            width: 20,
            height: 40,
            angle: 0,
            speed: 0,
            color: '#ff0000',
            waypointIndex: 0,
            lapProgress: 0
        };

        // AI cars
        let aiCars = [];
        let numAICars = 7;
        
        // Track and racing
        let currentLap = 1;
        let totalLaps = 3;
        let racePosition = 1;
        let raceTime = 0;
        let lapTimes = [];
        let checkpoints = [];
        
        // Track waypoints for AI
        let trackWaypoints = [
            {x: 400, y: 550},
            {x: 200, y: 450},
            {x: 100, y: 300},
            {x: 150, y: 150},
            {x: 350, y: 100},
            {x: 650, y: 150},
            {x: 700, y: 300},
            {x: 600, y: 450},
            {x: 400, y: 550}
        ];

        // Input handling
        let keys = {};
        
        document.addEventListener('keydown', (e) => {
            keys[e.key] = true;
            if (e.key === 'r' || e.key === 'R') {
                if (gameState === 'playing') restartGame();
            }
        });
        
        document.addEventListener('keyup', (e) => {
            keys[e.key] = false;
        });

        // Initialize AI cars
        function initAICars() {
            aiCars = [];
            for (let i = 0; i < numAICars; i++) {
                aiCars.push({
                    x: 380 + (i % 3) * 20,
                    y: 520 - i * 30,
                    width: 20,
                    height: 40,
                    angle: 0,
                    speed: 40 + Math.random() * 30, // Reduced from 80 + Math.random() * 40
                    color: `hsl(${Math.random() * 360}, 70%, 50%)`,
                    waypointIndex: 0,
                    lapProgress: 0
                });
            }
        }

        // Initialize checkpoints
        function initCheckpoints() {
            checkpoints = [
                {x: 400, y: 550, passed: false}, // Start/finish
                {x: 150, y: 300, passed: false}, // Left turn
                {x: 350, y: 100, passed: false}, // Top
                {x: 650, y: 300, passed: false}  // Right turn
            ];
        }

        function startGame() {
            gameState = 'playing';
            document.getElementById('startScreen').style.display = 'none';
            document.getElementById('gameOver').style.display = 'none';
            
            // Reset game state
            player.x = 400;
            player.y = 500;
            player.angle = 0;
            player.waypointIndex = 0;
            player.lapProgress = 0;
            speed = 0;
            currentLap = 1;
            racePosition = 1;
            raceTime = 0;
            lapTimes = [];
            turboEnergy = 100;
            
            initAICars();
            initCheckpoints();
            
            gameLoop();
        }

        function restartGame() {
            startGame();
        }

        function showStartScreen() {
            gameState = 'start';
            document.getElementById('startScreen').style.display = 'block';
            document.getElementById('gameOver').style.display = 'none';
        }

        function goHome() {
            window.location.href = 'index.html';
        }

        function updatePlayer() {
            // Handle input
            if (keys['ArrowUp']) {
                speed = Math.min(speed + acceleration, maxSpeed);
                if (turboBoost && turboEnergy > 0) {
                    speed = Math.min(speed + acceleration * 2, maxSpeed * 1.5);
                    turboEnergy -= 2;
                }
            } else if (keys['ArrowDown']) {
                speed = Math.max(speed - deceleration * 2, -maxSpeed * 0.5);
            } else {
                speed *= 0.95; // Natural deceleration
            }
            
            if (keys['ArrowLeft']) {
                // Improved turning: base turn rate + speed-dependent component
                let baseTurnRate = 0.03;
                let speedTurnRate = 0.02 * (speed / maxSpeed);
                player.angle -= baseTurnRate + speedTurnRate;
            }
            if (keys['ArrowRight']) {
                // Improved turning: base turn rate + speed-dependent component
                let baseTurnRate = 0.03;
                let speedTurnRate = 0.02 * (speed / maxSpeed);
                player.angle += baseTurnRate + speedTurnRate;
            }
            
            turboBoost = keys[' '] && turboEnergy > 0;
            if (!turboBoost && turboEnergy < 100) {
                turboEnergy += 0.5;
            }
            
            // Update position
            player.x += Math.sin(player.angle) * speed * 0.1;
            player.y -= Math.cos(player.angle) * speed * 0.1;
            
            // Keep player on screen
            player.x = Math.max(10, Math.min(canvas.width - 10, player.x));
            player.y = Math.max(10, Math.min(canvas.height - 10, player.y));
            
            // Update player waypoint progress (similar to AI cars)
            let targetWaypoint = trackWaypoints[player.waypointIndex];
            let dx = targetWaypoint.x - player.x;
            let dy = targetWaypoint.y - player.y;
            let distance = Math.sqrt(dx * dx + dy * dy);
            
            if (distance < 80) { // Slightly larger threshold for player
                player.waypointIndex = (player.waypointIndex + 1) % trackWaypoints.length;
                if (player.waypointIndex === 0) player.lapProgress++;
            }
            
            // Check checkpoints
            checkCheckpoints();
        }

        function updateAICars() {
            aiCars.forEach(car => {
                // Simple AI: follow waypoints
                let targetWaypoint = trackWaypoints[car.waypointIndex];
                let dx = targetWaypoint.x - car.x;
                let dy = targetWaypoint.y - car.y;
                let distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance < 50) {
                    car.waypointIndex = (car.waypointIndex + 1) % trackWaypoints.length;
                    if (car.waypointIndex === 0) car.lapProgress++;
                }
                
                // Move towards waypoint
                let targetAngle = Math.atan2(dx, -dy);
                car.angle = targetAngle;
                
                // Add some variation to AI speed
                car.speed += (Math.random() - 0.5) * 1; // Reduced variation
                car.speed = Math.max(30, Math.min(70, car.speed)); // Reduced speed range
                
                car.x += Math.sin(car.angle) * car.speed * 0.06; // Reduced from 0.08
                car.y -= Math.cos(car.angle) * car.speed * 0.06;
            });
        }

        function checkCheckpoints() {
            checkpoints.forEach((checkpoint, index) => {
                let dx = player.x - checkpoint.x;
                let dy = player.y - checkpoint.y;
                let distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance < 60 && !checkpoint.passed) {
                    checkpoint.passed = true;
                }
            });
            
            // Check if we've passed the start/finish line after passing other checkpoints
            let startFinish = checkpoints[0];
            let dx = player.x - startFinish.x;
            let dy = player.y - startFinish.y;
            let distance = Math.sqrt(dx * dx + dy * dy);
            
            // If we're near start/finish and have passed at least 2 other checkpoints, complete lap
            if (distance < 60 && checkpoints.slice(1).filter(cp => cp.passed).length >= 2) {
                completeLap();
            }
        }

        function completeLap() {
            currentLap++;
            lapTimes.push(raceTime);
            
            // Reset checkpoints
            checkpoints.forEach(cp => cp.passed = false);
            
            if (currentLap > totalLaps) {
                endRace();
            }
        }

        function endRace() {
            gameState = 'gameOver';
            document.getElementById('gameOver').style.display = 'block';
            document.getElementById('finalPosition').textContent = racePosition;
            
            let bestLap = Math.min(...lapTimes);
            let minutes = Math.floor(bestLap / 60);
            let seconds = (bestLap % 60).toFixed(1);
            document.getElementById('bestLap').textContent = `${minutes}:${seconds.padStart(4, '0')}`;
        }

        function updateRacePosition() {
            // Improved position calculation using waypoint progress for both player and AI
            let playerProgress = player.lapProgress * trackWaypoints.length + player.waypointIndex;
            let position = 1;
            
            aiCars.forEach(car => {
                let aiProgress = car.lapProgress * trackWaypoints.length + car.waypointIndex;
                if (aiProgress > playerProgress) {
                    position++;
                }
            });
            
            racePosition = position;
        }

        function drawTrack() {
            // Draw grass background
            ctx.fillStyle = '#228b22';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Draw track (simple oval)
            ctx.strokeStyle = '#444';
            ctx.lineWidth = 100;
            ctx.beginPath();
            ctx.ellipse(400, 300, 250, 200, 0, 0, Math.PI * 2);
            ctx.stroke();
            
            // Draw track surface
            ctx.strokeStyle = '#666';
            ctx.lineWidth = 80;
            ctx.beginPath();
            ctx.ellipse(400, 300, 250, 200, 0, 0, Math.PI * 2);
            ctx.stroke();
            
            // Draw center line
            ctx.strokeStyle = '#fff';
            ctx.lineWidth = 2;
            ctx.setLineDash([10, 10]);
            ctx.beginPath();
            ctx.ellipse(400, 300, 250, 200, 0, 0, Math.PI * 2);
            ctx.stroke();
            ctx.setLineDash([]);
            
            // Draw start/finish line
            ctx.fillStyle = '#fff';
            ctx.fillRect(390, 480, 20, 40);
            ctx.fillStyle = '#000';
            for (let i = 0; i < 4; i++) {
                for (let j = 0; j < 2; j++) {
                    if ((i + j) % 2 === 0) {
                        ctx.fillRect(390 + j * 10, 480 + i * 10, 10, 10);
                    }
                }
            }
        }

        function drawCar(car) {
            ctx.save();
            ctx.translate(car.x, car.y);
            ctx.rotate(car.angle);
            
            // Car body
            ctx.fillStyle = car.color;
            ctx.fillRect(-car.width/2, -car.height/2, car.width, car.height);
            
            // Car details
            ctx.fillStyle = '#000';
            ctx.fillRect(-car.width/2 + 2, -car.height/2 + 5, car.width - 4, 8);
            ctx.fillRect(-car.width/2 + 2, car.height/2 - 13, car.width - 4, 8);
            
            ctx.restore();
        }

        function drawUI() {
            // Update UI elements
            document.getElementById('speed').textContent = Math.round(speed);
            document.getElementById('lap').textContent = currentLap;
            document.getElementById('position').textContent = racePosition;
            
            let minutes = Math.floor(raceTime / 60);
            let seconds = (raceTime % 60).toFixed(1);
            document.getElementById('time').textContent = `${minutes}:${seconds.padStart(4, '0')}`;
            
            // Draw turbo energy bar
            ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
            ctx.fillRect(10, 100, 104, 14);
            ctx.fillStyle = turboEnergy > 30 ? '#00ff00' : '#ff0000';
            ctx.fillRect(12, 102, turboEnergy, 10);
            
            ctx.fillStyle = '#fff';
            ctx.font = '12px Courier New';
            ctx.fillText('TURBO', 10, 95);
        }

        function render() {
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            drawTrack();
            
            // Draw AI cars
            aiCars.forEach(car => drawCar(car));
            
            // Draw player car
            drawCar(player);
            
            drawUI();
        }

        function gameLoop() {
            if (gameState !== 'playing') return;
            
            updatePlayer();
            updateAICars();
            updateRacePosition();
            
            raceTime += 1/60; // Assuming 60 FPS
            
            render();
            
            requestAnimationFrame(gameLoop);
        }

        // Initialize the game
        showStartScreen();
    </script>
</body>
</html>

